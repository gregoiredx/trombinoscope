<html>
    <head>
        <script type="text/javascript" src="mustache.min.js" ></script>

       <script id="template" type="text/html">
            {{#images}}
                <img src="{{ src }}" title="{{ name }}" width="200">
            {{/images}}
       </script>

    </head>
    <body>

        <input type="file" name="client-file" id="get-files" multiple  />

        <div id="img_container">

        </div>

        <script>
            var filesInput = document.getElementById("get-files");
            filesInput.onchange = function() {
                for (i = 0; i < filesInput.files.length; i++) {
                    var file = filesInput.files[i];
                    console.log(file);
                    addImage(file, i, i == filesInput.files.length - 1);
                }
            }

            var images = [];

            function addImage(file, i, last) {
                var reader  = new FileReader();
                reader.onload = function () {
                    images[i] = {src : reader.result, name: file.name.replace(/\.[^/.]+$/, "").replace("_", " ")};
                    if(last){
                        showImages();
                    }
                }
                reader.readAsDataURL(file);
            }

            function showImages() {
                var imgContainer = document.getElementById("img_container");
                while (imgContainer.firstChild) {
                    imgContainer.removeChild(imgContainer.firstChild);
                }
                var model = {"images": images};
                var template = document.getElementById("template").innerHTML;
                var output = Mustache.render(template, model);
                document.body.innerHTML = output;
            }

        </script>

    </body>
    <html>
